# 실행 파일 : namani.py

## 개요
- .py
  - namani.py : 메인 코드
  - embedding.py : 텍스트 데이터 백터화(필요할 때만)
  - cleanTxt.py : 텍스트 데이터 정제
- dir
  - pdfdir : pdf 파일
  - TextData : 텍스트 데이터
  - vector_faissdb : 임베딩한 데이터


## 할 일
- embedding 폴더 txt -> dir 경로 수정 후 한번에 진행
- stream, prompt 비교해 보고
- front에서 cookie, session 등으로 한번씩 넣어줄 수 있는지

## 연결 위치
- S09P22A410 frontend src templates chatbot-template ChatBotTemplate.js

## 오류




## 개선점
### 만족스럽지 않은 응답
- req :     req = {
        "preMessage": "",
        "tempMessage": "최불암 시리즈 하나 이야기해줘"
    }
- res : 
최불암 시리즈는 최진실의 모험과 용기를 그린 이야기인데요, 처음 이야기는 최불암이 수십 명의 사람들에게 쫓기는 상황에서 시작되죠. 벼랑 끝에까지 몰리다가는 절벽 밑의 바다로 뛰어내려갑니다. 이 때, 기적처럼 최불암을 구해준 모터보트를 탄 노주현이 등장하죠. 그리고 함께 성인봉 방향으로 모터보트를 몰고 나가는데요, 아침 노을이 떠오르는 울릉도의 성인봉에서 최불암과 노주현이 선글라스를 쓰고 멋진 모습을 보여주며, "최불암 시리즈 앞으로 많은 기대 바랍니다"라고 말합니다. 최불암 시리즈는 이렇게 흥미진진하고 장엄한 모험을 그린 이야기입니다.

- 최불암 시리즈를 임베딩하였지만 이야기가 엉터리로 나옵니다, 기존 이야기의 등장인물들이 다 섞여서 나옵니다 -> 재미가 없음
- 재미있는 이야기를 그대로 뽑아내는게 더 좋을 것 같다
- 재미있는 이야기를 해달라고 요청하면 이야기 db에서 랜덤으로 하나 뽑아서 보여주기-> 
    - 이건 fastapi에서가 아니라 FE에서 바로 보여주면 -> 빠른 응답
        - 대신 입력 포멧이 애매해짐
    - fastapi에서 입력받고 어떤 요청사항일 경우 특정 작업을 수행하라고 명령(예를 들어 db에서 이야기 가져오기)
        - 느린 응답
        - 유연한 (텍스트 입출력)
        - autogpt 적용 고려<<<
- 이야기 통째로 chunk 하지 않는 이유 : openai.error.InvalidRequestError: This model's maximum context length is 8192 tokens. However, your messages resulted in 59560 tokens.

#### 개선 1 : 이야기별로 분할 후 chunk
- 각 에피소드별로 분할하고 다시 임베딩하였습니다
- 결과 : 비슷한 에피소드가 나오나 완전히 동일하지는 않습니다

#### 개선 2 : 각 이야기에 키워드 추가
- 각 파일에 "재미있는", "이야기"와 같은 키워드를 추가해주었습니다
- 결과 : 재미있는 이야기를 해달라는 질문에 대해서 이전보다 원본에 가까운 형태로 이야기가 나옵니다

#### to do
- autogpt / 단순 txt 생성 외에 요청 분석해서 특정 동작 수행하도록 적용 가능하도록


## res, req 예시
### 01  
- req
```
    req = {
        "preMessage": "",
        "tempMessage": "재미있는 유머 추천해줘"
    }
```
- res
- 어른들을 위한 재미있는 유머 추천해드릴게요. 어른들은 일상생활 속에서 겪는 다양한 상황을 재치 있게 풀어낸 유머를 즐기는 경우가 많습니다. 예를 들어, "회원님, 여기 저녁시간에 많이 붐빕니다. 이런 참을성이 대단하신 분은 드문 편이에요. 월세로 사는 집주인분도 저 참을성을 보고 임대로 바꾸셔야겠다고 생각하실 겁니다."와 같은 부동산 관련 유머는 어른들 사이에서 인기가 많습니다. 또한, 공부와 관련된 유머도 어른들에게 재미로 전달될 수 있습니다. "수능 끝나자마자 동생은 바로 친구 만나러 나갔다. 나는 뭔가 잊은 거 같은데... 아! 학교!"와 같은 공부에 대한 관능적인 유머도 인기가 있을 것입니다. 즐겁게 웃을 수 있는 유머를 통해 어른들도 일상에서의 스트레스를 해소할 수 있도록 도움을 주시면 좋을 것 같습니다.

### 02 
- req
```
     req = {
        "preMessage": "",
        "tempMessage": "노인일자리 참여대상을 알려줘"
    }
```
- res
```
- res 
dict_keys(['message'])
노인일자리 참여 대상은 만 65세 이상인 분들이 대상입니다. 공공형으로는 기초연금 수급자가, 사회서비스형으로는 일부 유형은 만 60세 이상 사업 참여가 가능합니다. 노인분들의 노후생활을 지원하고 건강하고 활기찬 삶을 영위할 수 있도록 다양한 사회활동을 지원해주고 있습니다.
```
- 참조 문서 : 노인일자리및사회활동지원사업

### 03 
- req
  - 재미있는 이야기
- res 
  - 아, 어떤 이야기를 들려드릴까요? 재미있는 이야기를 좋아하시는 분이신가요? 저는 최근에 들은 한 가지 이야기를 소개해드릴게요.
    한 번 곰보빵 가게에 간 최불암씨가, 새로운 종업원의 얼굴이 얽어 있는 것을 봤대요. 그런데 최불암씨는 상처를 주지 않기 위해 얼굴을 얽은 종업원에게 "소보로 누나! 곰보빵 주세요!"라고 당당하게 말한대요. 그 종업원은 당황하면서도 최불암씨에게 곰보빵을 주었답니다.
    이야기는 아마도 최불암씨가 다른 사람의 외모나 상황에 상처를 주지 않으려는 대단한 배려심을 가지고 있다는 것을 보여줍니다. 사람들 사이에서 배려와 존중은 정말 소중한 가치들이죠. 우리도 최불암씨처럼 다른 사람을 더 배려해볼까요?
    혹시 다른 이야기를 듣고 싶으신가요? 이야기가 더 많이 있어요. 저는 늘 귀 기울여 들어줄게요.